{% extends 'base.html' %}

{% block content %}
    
    <!-- Основной контент -->
    <div class="container">
        <h2>Отправить изображение</h2>
        <div class="sending">
            <label class="file-upload" for="fileInput">Выберите файл</label>
            <input type="file" id="fileInput" name="image_da" accept="image/*">
            <div id="progress">
                <div id="progressBar"></div>
            </div>
            <div id="remainingTime"></div>

            <br>
            <button type="submit">Отправть</button>
        </div>

        <div id="message"></div>
    </div>
    <script>
        const button = document.getElementById('theme-toggle');
        button.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            document.body.classList.toggle('light-theme');
        });
    </script>
    <script>
        const fileInput = document.getElementById('fileInput');
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const remainingTimeDisplay = document.getElementById('remainingTime');
        const preview = document.getElementById('preview');

        fileInput.addEventListener('change', event => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                progress.style.display = 'block';
                const total = file.size;
                let startTime = null;

                reader.onprogress = function (e) {
                    if (e.lengthComputable) {
                        const loaded = e.loaded;
                        const percentage = (loaded / total) * 100;
                        progressBar.style.width = percentage + '%';

                        // Вычисление оставшегося времени
                        if (startTime === null) {
                            startTime = new Date();
                        }
                        const currentTime = new Date();
                        const elapsedTime = (currentTime - startTime) / 1000; // в секундах
                        const remainingTime = (elapsedTime / (loaded / total)) - elapsedTime; // оставшееся время
                        remainingTimeDisplay.textContent = `Оставшееся время: ${remainingTime >= 0 ? Math.ceil(remainingTime) + ' секунд' : 'завершено!'}`;
                    }
                };

                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    progress.style.display = 'none'; // Скрыть индикатор после загрузки
                    remainingTimeDisplay.textContent = 'Загрузка завершена!';
                };

                reader.readAsDataURL(file);
            }
        });
    </script>
{% endblock %}